#!/bin/sh

set -e

# Firefox launcher containing a Profile migration helper for
# temporary profiles used during alpha and beta phases.

# Authors:
#  Alexander Sack <asac@jwsdot.com>
#  Fabien Tassin <fta@sofaraway.org>
#  Steve Langasek <steve.langasek@canonical.com>
#  Chris Coulson <chris.coulson@canonical.com>
# License: GPLv2 or later

MOZ_LIBDIR=@MOZ_LIBDIR@
MOZ_APP_LAUNCHER=`which $0`
MOZ_APP_NAME=@MOZ_APP_NAME@
MOZ_APP_BASENAME=@MOZ_APP_BASENAME@
MOZ_PROFILE_PREFIX=@MOZ_PROFILE_PREFIX@

export MOZ_APP_LAUNCHER

while [ ! -x $MOZ_LIBDIR/$MOZ_APP_NAME ] ; do
    if [ -L "$MOZ_APP_LAUNCHER" ] ; then
        MOZ_APP_LAUNCHER=`readlink -f $MOZ_APP_LAUNCHER`
        MOZ_LIBDIR=`dirname $MOZ_APP_LAUNCHER`
    else
       echo "Can't find $MOZ_LIBDIR/$MOZ_APP_NAME"
       exit 1
    fi
done

%%if MOZ_APP_NAME != MOZ_APP_BASENAME
if [ $MOZ_APP_NAME != $MOZ_APP_BASENAME ] &&
   [ ! -e ${HOME}/${MOZ_PROFILE_PREFIX}${MOZ_APP_NAME} ] &&
   [ -d ${HOME}/${MOZ_PROFILE_PREFIX}${MOZ_APP_BASENAME} ] ; then
    cp -r ${HOME}/${MOZ_PROFILE_PREFIX}${MOZ_APP_BASENAME} ${HOME}/${MOZ_PROFILE_PREFIX}${MOZ_APP_NAME}
fi
%%endif

exec $MOZ_LIBDIR/$MOZ_APP_NAME "$@"
