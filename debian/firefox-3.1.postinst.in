#!/bin/sh

set -e

UPDATENOTIFIERDIR=/var/lib/update-notifier/user.d
LIBDIR=@LIBDIR@

if [ "$1" = "configure" ] || [ "$1" = "abort-upgrade" ] ; then
    update-alternatives --install /usr/bin/x-www-browser \
        x-www-browser /usr/bin/firefox-3.1 40
    touch $LIBDIR/.autoreg
fi

echo "Please restart all running instances of Firefox-3.1, or you will experience problems."

if [ -d $UPDATENOTIFIERDIR ] ; then
  # pgrep matches application names from /proc/<pid>/status which is
  # truncated according to sys/procfs.h definition. Problem is it's
  # platform dependent. Either 15 or 16 chars.
  if [ `/usr/bin/pgrep -x -c firefox` -ne 0 ] ;  then
    cp -f $LIBDIR/firefox-3.1-restart-required.update-notifier \
        $UPDATENOTIFIERDIR/firefox-3.1-restart-required
  else
    rm -f $UPDATENOTIFIERDIR/firefox-3.1-restart-required
  fi
fi
