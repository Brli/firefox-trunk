Index: firefox-trunk-19.0~a1~hg20121114r113129/toolkit/components/contentprefs/tests/unit/head_contentPrefs.js
===================================================================
--- firefox-trunk-19.0~a1~hg20121114r113129.orig/toolkit/components/contentprefs/tests/unit/head_contentPrefs.js	2012-11-14 00:37:52.000000000 +0000
+++ firefox-trunk-19.0~a1~hg20121114r113129/toolkit/components/contentprefs/tests/unit/head_contentPrefs.js	2012-11-14 15:14:25.574479000 +0000
@@ -45,34 +45,6 @@
 
 
   //**************************************************************************//
-  // nsISupports
-  
-  interfaces: [Ci.nsIDirectoryServiceProvider, Ci.nsISupports],
-
-  QueryInterface: function ContentPrefTest_QueryInterface(iid) {
-    if (!this.interfaces.some( function(v) { return iid.equals(v) } ))
-      throw Cr.NS_ERROR_NO_INTERFACE;
-    return this;
-  },
-
-
-  //**************************************************************************//
-  // nsIDirectoryServiceProvider
-
-  getFile: function ContentPrefTest_getFile(property, persistent) {
-    persistent.value = true;
-
-    if (property == "ProfD")
-      return this._dirSvc.get("CurProcD", Ci.nsIFile);
-
-    // This causes extraneous errors to show up in the log when the directory
-    // service asks us first for CurProcD and MozBinD.  I wish there was a way
-    // to suppress those errors.
-    throw Cr.NS_ERROR_FAILURE;
-  },
-
-
-  //**************************************************************************//
   // Utilities
 
   getURI: function ContentPrefTest_getURI(spec) {
@@ -84,20 +56,7 @@
    * of that directory if necessary.
    */
   getProfileDir: function ContentPrefTest_getProfileDir() {
-    var profileDir;
-
-    try {
-      profileDir = this._dirSvc.get("ProfD", Ci.nsIFile);
-    }
-    catch (e) {}
-
-    if (!profileDir) {
-      this._dirSvc.QueryInterface(Ci.nsIDirectoryService).registerProvider(this);
-      profileDir = this._dirSvc.get("ProfD", Ci.nsIFile);
-      this._dirSvc.unregisterProvider(this);
-    }
-
-    return profileDir;
+    return this._dirSvc.get("ProfD", Ci.nsIFile);
   },
 
   /**
@@ -136,6 +95,8 @@
 
 };
 
+do_get_profile();
+
 let gInPrivateBrowsing = false;
 function enterPBMode() {
   gInPrivateBrowsing = true;
@@ -145,8 +106,6 @@
   Services.obs.notifyObservers(null, "last-pb-context-exited", null);
 }
 
-ContentPrefTest.deleteDatabase();
-
 function inChildProcess() {
   var appInfo = Cc["@mozilla.org/xre/app-info;1"];
   if (!appInfo || appInfo.getService(Ci.nsIXULRuntime).processType ==
Index: firefox-trunk-19.0~a1~hg20121114r113129/toolkit/components/contentprefs/tests/unit/tail_contentPrefs.js
===================================================================
--- firefox-trunk-19.0~a1~hg20121114r113129.orig/toolkit/components/contentprefs/tests/unit/tail_contentPrefs.js	2012-11-14 00:37:52.000000000 +0000
+++ /dev/null	1970-01-01 00:00:00.000000000 +0000
@@ -1,6 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-ContentPrefTest.deleteDatabase();
-ContentPrefTest.__dirSvc = null;
Index: firefox-trunk-19.0~a1~hg20121114r113129/toolkit/components/contentprefs/tests/unit/xpcshell.ini
===================================================================
--- firefox-trunk-19.0~a1~hg20121114r113129.orig/toolkit/components/contentprefs/tests/unit/xpcshell.ini	2012-11-14 00:37:52.000000000 +0000
+++ firefox-trunk-19.0~a1~hg20121114r113129/toolkit/components/contentprefs/tests/unit/xpcshell.ini	2012-11-14 15:13:39.898480000 +0000
@@ -1,6 +1,6 @@
 [DEFAULT]
 head = head_contentPrefs.js
-tail = tail_contentPrefs.js
+tail =
 
 [test_bug248970.js]
 [test_bug503971.js]
