---
 browser/components/preferences/security.js  |    4 ++--
 browser/components/preferences/security.xul |    4 ++--
 security/nss/lib/softoken/legacydb/lgattr.c |    4 ++--
 toolkit/mozapps/preferences/changemp.xul    |    4 ++--
 4 files changed, 8 insertions(+), 8 deletions(-)

Index: mozilla/browser/components/preferences/security.js
===================================================================
--- mozilla.orig/browser/components/preferences/security.js	2007-08-14 14:00:18.000000000 +0000
+++ mozilla/browser/components/preferences/security.js	2007-08-14 14:02:22.000000000 +0000
@@ -356,18 +356,18 @@
    * the master password button to show, and enables/disables it as necessary.
    * The master password is controlled by various bits of NSS functionality, so
    * the UI for it can't be controlled by the normal preference bindings.
    */
   _initMasterPasswordUI: function ()
   {
     var noMP = !this._masterPasswordSet();
 
-    //var button = document.getElementById("changeMasterPassword");
-    //button.disabled = noMP;
+    var button = document.getElementById("changeMasterPassword");
+    button.disabled = noMP;
 
     var checkbox = document.getElementById("useMasterPassword");
     checkbox.checked = !noMP;
   },
 
   /**
    * Returns true if the user has a master password set and false otherwise.
    */
Index: mozilla/browser/components/preferences/security.xul
===================================================================
--- mozilla.orig/browser/components/preferences/security.xul	2007-08-01 23:26:35.000000000 +0000
+++ mozilla/browser/components/preferences/security.xul	2007-08-14 14:02:22.000000000 +0000
@@ -138,21 +138,21 @@
                   onsyncfrompreference="return gSecurityPane.readSavePasswords();"/>
         <button id="passwordExceptions"
                 label="&passwordExceptions.label;"
                 accesskey="&passwordExceptions.accesskey;"
                 oncommand="gSecurityPane.showPasswordExceptions();"
                 preference="pref.privacy.disable_button.view_passwords_exceptions"/>
       </hbox>
       <hbox id="masterPasswordBox">
-        <checkbox id="useMasterPassword" flex="1" disabled="true"
+        <checkbox id="useMasterPassword" flex="1"
                   oncommand="gSecurityPane.updateMasterPasswordButton();"
                   label="&useMasterPassword.label;"
                   accesskey="&useMasterPassword.accesskey;"/>
-        <button id="changeMasterPassword" disabled="true"
+        <button id="changeMasterPassword"
                 label="&changeMasterPassword.label;"
                 accesskey="&changeMasterPassword.accesskey;"
                 oncommand="gSecurityPane.changeMasterPassword();"/>
       </hbox>
 
       <hbox id="showPasswordsBox">
         <spacer flex="1"/>
         <button id="showPasswords"
Index: mozilla/security/nss/lib/softoken/legacydb/lgattr.c
===================================================================
--- mozilla.orig/security/nss/lib/softoken/legacydb/lgattr.c	2007-06-13 21:01:29.000000000 +0000
+++ mozilla/security/nss/lib/softoken/legacydb/lgattr.c	2007-08-14 14:02:22.000000000 +0000
@@ -1732,18 +1732,18 @@
     /* Write any collected changes out for private and secret keys.
      *  don't do the write for just the label */
     if (writePrivate) {
 	NSSLOWKEYPrivateKey *privKey = lg_GetPrivateKey(obj);
 	SECStatus rv = SECFailure;
 	char * label = lg_FindKeyNicknameByPublicKey(obj->sdb, &obj->dbKey);
 
 	if (privKey) {
-	    rv = nsslowkey_StoreKeyByPublicKey(lg_getKeyDB(sdb), privKey, 
-		&obj->dbKey, label, sdb );
+	    rv = nsslowkey_StoreKeyByPublicKeyAlg(lg_getKeyDB(sdb), privKey,
+		&obj->dbKey, label, sdb, PR_TRUE );
 	}
 	if (rv != SECSuccess) {
 	    crv = CKR_DEVICE_ERROR;
 	}
     }
 
     lg_DestroyObjectCache(obj);
     return crvCollect;
Index: mozilla/toolkit/mozapps/preferences/changemp.xul
===================================================================
--- mozilla.orig/toolkit/mozapps/preferences/changemp.xul	2007-08-14 14:00:18.000000000 +0000
+++ mozilla/toolkit/mozapps/preferences/changemp.xul	2007-08-14 14:02:22.000000000 +0000
@@ -75,22 +75,22 @@
                 than one tokens, some initialized and some not - does not work properly. So, 
                 either the textbox 'oldpw' or the textbox 'message' would be displayed, 
                 depending on the state of the token selected 
           -->
           <textbox id="message" disabled="true" />
         </row>
         <row>
           <label control="pw1" value="&setPassword.newPassword.label;"/> 
-          <textbox id="pw1" type="password" disabled="true"
+          <textbox id="pw1" type="password"
                    oninput="setPasswordStrength(); checkPasswords();"/> 
         </row>
         <row>
           <label control="pw2" value="&setPassword.reenterPassword.label;"/> 
-          <textbox id="pw2" type="password" disabled="true" oninput="checkPasswords();"/>  
+          <textbox id="pw2" type="password" oninput="checkPasswords();"/>
         </row>
       </rows>
     </grid>
   </groupbox>
 
   <groupbox>
     <caption label="&setPassword.meter.label;"/>
     <progressmeter id="pwmeter" mode="determined" value="0"/>
