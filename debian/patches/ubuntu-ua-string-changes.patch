Description: Add "Ubuntu" to the platform part of the UA string
Author: Chris Coulson <chris.coulson@canonical.com>
Forwarded: not-needed

Index: mozilla/netwerk/protocol/http/Makefile.in
===================================================================
--- mozilla.orig/netwerk/protocol/http/Makefile.in	2012-01-03 02:09:16.000000000 +0000
+++ mozilla/netwerk/protocol/http/Makefile.in	2012-01-04 00:18:41.514892835 +0000
@@ -126,3 +126,7 @@
 include $(topsrcdir)/config/rules.mk
 
 DEFINES += -DIMPL_NS_NET
+
+ifdef MOZ_UA_VENDOR
+DEFINES += -DMOZ_UA_VENDOR=\""$(MOZ_UA_VENDOR)"\"
+endif
Index: mozilla/netwerk/protocol/http/nsHttpHandler.cpp
===================================================================
--- mozilla.orig/netwerk/protocol/http/nsHttpHandler.cpp	2012-01-03 02:09:17.000000000 +0000
+++ mozilla/netwerk/protocol/http/nsHttpHandler.cpp	2012-01-04 00:27:56.814882968 +0000
@@ -193,6 +193,9 @@
     , mLegacyAppName("Mozilla")
     , mLegacyAppVersion("5.0")
     , mProduct("Gecko")
+#ifdef MOZ_UA_VENDOR
+    , mVendor(MOZ_UA_VENDOR)
+#endif
     , mUserAgentIsDirty(true)
     , mUseCache(true)
     , mPromptTempRedirect(true)
@@ -291,6 +294,9 @@
     LOG(("> misc = %s\n", mMisc.get()));
     LOG(("> product = %s\n", mProduct.get()));
     LOG(("> product-sub = %s\n", mProductSub.get()));
+#ifdef MOZ_UA_VENDOR
+    LOG(("> vendor = %s\n", mVendor.get()));
+#endif
     LOG(("> app-name = %s\n", mAppName.get()));
     LOG(("> app-version = %s\n", mAppVersion.get()));
     LOG(("> compat-firefox = %s\n", mCompatFirefox.get()));
@@ -590,6 +596,9 @@
     // than if we didn't preallocate at all.
     mUserAgent.SetCapacity(mLegacyAppName.Length() + 
                            mLegacyAppVersion.Length() + 
+#ifdef MOZ_UA_VENDOR
+                           mVendor.Length() + 
+#endif
 #ifndef UA_SPARE_PLATFORM
                            mPlatform.Length() + 
 #endif
@@ -600,7 +609,7 @@
                            mAppName.Length() +
                            mAppVersion.Length() +
                            mCompatFirefox.Length() +
-                           13);
+                           15);
 
     // Application portion
     mUserAgent.Assign(mLegacyAppName);
@@ -614,6 +623,10 @@
     mUserAgent += mPlatform;
     mUserAgent.AppendLiteral("; ");
 #endif
+#ifdef MOZ_UA_VENDOR
+    mUserAgent += mVendor;
+    mUserAgent.AppendLiteral("; ");
+#endif
     mUserAgent += mOscpu;
     mUserAgent.AppendLiteral("; ");
     mUserAgent += mMisc;
@@ -648,7 +661,6 @@
 void
 nsHttpHandler::InitUserAgentComponents()
 {
-
       // Gather platform.
     mPlatform.AssignLiteral(
 #if defined(ANDROID)
Index: mozilla/netwerk/protocol/http/nsHttpHandler.h
===================================================================
--- mozilla.orig/netwerk/protocol/http/nsHttpHandler.h	2012-01-03 02:09:17.000000000 +0000
+++ mozilla/netwerk/protocol/http/nsHttpHandler.h	2012-01-04 00:18:41.514892835 +0000
@@ -312,6 +312,7 @@
     // useragent components
     nsCString      mLegacyAppName;
     nsCString      mLegacyAppVersion;
+    nsCString      mVendor;
     nsCString      mPlatform;
     nsCString      mOscpu;
     nsCString      mMisc;
