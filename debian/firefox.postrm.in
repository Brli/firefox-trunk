#!/bin/sh

set -e

APP_NAME=@MOZ_APP_NAME@

abort_mv_conffile() {
    local CONFFILE="$1"

    if [ -e "$CONFFILE.dpkg-remove" ]; then
        echo "Reinstalling $CONFFILE that was moved away"
        mv "$CONFFILE.dpkg-remove" "$CONFFILE"
    fi
}

if [ "$1" = "purge" ]; then
    APP_PROFILE="usr.bin.@MOZ_APP_NAME@"
    rm -f /etc/apparmor.d/force-complain/$APP_PROFILE || true
    rm -f /etc/apparmor.d/disable/$APP_PROFILE || true
    rm -f /etc/apparmor.d/local/$APP_PROFILE || true
    rm -f "/etc/apparmor.d/abstractions/ubuntu-browsers.d/@MOZ_APP_NAME@" || true
    rmdir /etc/apparmor.d/local 2>/dev/null || true
fi

if [ "$1" = "abort-install" -o "$1" = "abort-upgrade" ] ; then
    abort_mv_conffile "/etc/${APP_NAME}/pref/firefox.js"
fi

#DEBHELPER#
